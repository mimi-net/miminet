<script src="{{ url_for('static', filename='/js/jquery-3.6.0.min.js') }}"></script>
<script src="{{ url_for('static', filename='/js/jquery-ui.min.js') }}"></script>
<link rel="stylesheet" href="{{url_for('static',filename='assets/css/workspace.css')}}">


<main>
    <section>
        <div class="col bg-light">
            <div id="network_scheme" class="position-absolute border bg-white border-primary h-100 w-100"></div>
        </div>

        <nav class="navbar">
            <a href="/">
                <img src="{{ url_for('static', filename='/images/logo.png') }}" class="position-absolute start-0 top-0" width="170" style="margin: 17px;" alt="Miminet">
            </a>

            {# Test name and section name #}
            <div class="ws-name-case position-absolute top-0 start-50 translate-middle-x" style="margin-top: 17px;">
                <b id="test_name" class="d-inline"></b>
                <b id="slash_symbol" class="d-inline"> / </b>
                <p style="font-weight: normal" id="section_name" class="d-inline"></p>
            </div>

            <div class="d-flex position-absolute end-0 top-0" style="margin: 17px;">
                {# Timer and counter #}
                <div class="col-auto d-flex align-items-center" 
                    style="display: none; font-size: 24px; opacity: 85%; white-space: nowrap; align-self: center; gap: 16px; margin-right: 17px;">
                    <p id="counter" style="margin: 0;">Вопрос <span id="currentQuestion">1</span> из <span id="totalQuestions">10</span></p>
                    {% if timer != 0 %}
                        <span id="timer" style="display: inline-block; width: 105px; text-align: right;">00:00:00</span>
                    {% endif %}
                </div>
                {# Finish button #}
                <div class="col-auto" style="align-self: flex-start;">
                    <button name="finishQuiz" aria-label="Завершить тест" class="btn btn-outline-danger btn-icon"
                            data-toggle="tooltip" data-bs-placement="right" title="Завершить тест">
                        <i class="bx bx-x fs-4 mx-1"></i>
                    </button>
                </div>
            </div>
        </nav>

        <div id="side_menu" class="position-absolute start-0 top-0" style="margin-left: 17px; margin-top: 100px;">
            <div class="ws-menu-devices-name">Устройства</div>
            <div class="ws-menu-devices">
                <div id="l2_switch_device" style="margin-top: 6px; margin-bottom: 6px;">
                    <img class="drag" id="l2_switch"
                         src="{{ url_for('static', filename='/images/l2_switch.png') }}"/>
                    <div class="icon-text">
                        <span data-bs-toggle="popover" data-bs-trigger="hover"
                              data-bs-content="Свитч (коммутатор) работает на втором уровне модели OSI.">Свитч (L2)</span>
                    </div>
                    <div id="l2_switch_counter"></div>
                </div>
                <div id="host_device" style="margin-top: 6px; margin-bottom: 6px;">
                    <img class="drag" id="host" src="{{ url_for('static', filename='/images/host.png') }}"/>
                    <div class="icon-text pt-2">
                        <span data-bs-toggle="popover" data-bs-trigger="hover"
                              data-bs-content="Хост - конечное сетевое устройство.">Хост</span>
                    </div>
                    <div id="host_counter"></div>
                </div>
                <div id="l1_hub_device" style="margin-top: 6px; margin-bottom: 6px;">
                    <img class="drag" id="l1_hub" src="{{ url_for('static', filename='/images/hub.png') }}"/>
                    <div class="icon-text">
                        <span data-bs-toggle="popover" data-bs-trigger="hover"
                              data-bs-content="Хаб (концентратор) &mdash; простейшее сетевое устойство.">Хаб (L1)</span>
                    </div>
                    <div id="l1_hub_counter"></div>
                </div>
                <div id="l3_router_device" style="margin-top: 6px; margin-bottom: 6px;">
                    <img class="drag" id="l3_router"
                         src="{{ url_for('static', filename='/images/l3_router.png') }}"/>
                    <div class="icon-text">
                        <span data-bs-toggle="popover" data-bs-trigger="hover"
                              data-bs-content="Маршрутизатор (роутер, раутер) &mdash; работает на 3-м уровне модели OSI, позволяет объединять различные сети.">Роутер (L3)</span>
                    </div>
                    <div id="l3_router_counter"></div>
                </div>
                <div id="server_device" style="margin-top: 6px; margin-bottom: 6px;">
                    <img class="drag" id="server" src="{{ url_for('static', filename='/images/server.png') }}"/>
                    <div class="icon-text">
                        <span data-bs-toggle="popover" data-bs-trigger="hover"
                              data-bs-content="Сервер &mdash; обслуживает клиентские запросы.">Сервер</span>
                    </div>
                    <div id="server_counter"></div>
                </div>
            </div>
        </div>

        <div class="position-absolute end-0 top-0" style="margin-right: 17px; margin-top: 100px; pointer-events: none;">
            <div class="ws-menu-settings-name" style="pointer-events: all;">Настройки</div>
            <div id="config_content" class="ws-menu-settings overflow-auto" style="pointer-events: all;">
                <span>Тут будут настройки устройств. Выделите любое на схеме.</span>
            </div>
            <div id="config_content_save" class="ws-menu-settings overflow-auto" style="margin-top: 8px; pointer-events: all; display: none;">
            </div>
        </div>
        <div class="position-absolute start-0 bottom-0" style="margin: 17px; font-weight: 500;" id="NetworkPlayerDiv">
            <div class="d-flex justify-content-center ws-shadow" id="NetworkPlayer">
                <button type="button" class="btn btn-primary w-100" id="NetworkRunButton" disabled>
                    Эмулировать
                </button>
            </div>
            <div id="PacketSlider">
                <div class="range-slider pt-3" data-start-min="0" data-min="0" data-max="100" data-step="1">
                    <div class="range-slider-ui mt-0 mb-2" id="PacketSliderInput" style="display: none"></div>
                    <input class="form-control range-slider-value-min display: none" type="hidden">
                </div>
                <small id="NetworkPlayerLabel" class="d-flex justify-content-center text-muted text-center">Ожидание 10-30 сек.</small>
            </div>
        </div>

        <div id="hintModal" class="position-absolute start-0 bottom-0 modal" style="margin: 17px; font-weight: 500;" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Подсказки</h5>
                    </div>
                    <div class="modal-body">
                        <p id="hintsContainer"></p>
                    </div>
                    <div class="modal-footer">
                        <button id="networkConfigrationCancel" type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
                    </div>
                </div>
            </div>
        </div>
        
        {# Control buttons #}
        <div class="card-body position-absolute end-0 bottom-0" style="margin: 17px; font-weight: 500;">
            <div class="d-flex justify-content-center">
                {% if is_exam and not available_answer %}
                    <button name="answerExamQuestion" class="btn btn-primary">Ответить</button>
                {% else %}
                    <button name="answerQuestion" class="btn btn-primary">Ответить</button>
                {% endif %}
                
                <button name="nextQuestion" class="btn w-100 px-0" hidden>Следующий вопрос</button>
                <button name="seeResults" class="btn w-100 px-0"
                        style="word-wrap: break-word; white-space: initial;" hidden></button>
            
                <span id="answerSavedBanner" class="mt-2 text-success" style="display: none; font-weight: bold;">
                    ✔ Ответ сохранён
                </span>
            </div>
            <div style="margin: 17px; font-weight: 500; display: none;" id="scoreDisplay" >
                <p class="fs-5">Вы набрали <span id="score">0</span> баллов
                {% if not is_exam %}
                    <i id="hintIcon" class="bx bx-help-circle text-muted" style="cursor: pointer;"></i>
                {% endif %}
                </p>
            </div>
        </div>

        {# Explanation #}
        <div class="card-body position-absolute start-0 bottom-0" style="margin: 17px; font-weight: 500;">
            <div class="container" id="explanation"
                    style="margin: 24px 8px 24px 0; display: flex"
                    hidden></div>
        </div>


        {# Task text #}
        <div class="ws-name-case position-absolute bottom-0 start-50 translate-middle-x" style="margin-bottom: 17px;">
            <div class="practice-question-text"
                 style="max-height: 125px; overflow-y: auto; border: 0px solid #ddd; padding: 0px; border-radius: 0px; width: auto; min-width: fit-content; 
                    max-width: 100%; text-align: center;">
                <div class="text-black m-0" id="question_text" style="font-size: 20px;">{{ question.question_text }}</div>
            </div>
        </div>
</main>

<div id="config_host"></div>
<div id="config_hub"></div>
<div id="config_switch"></div>
<div id="config_edge"></div>
<div id="config_router"></div>
<div id="config_server"></div>
<div id="config_vlan"></div>
<div id="config_vxlan"></div>
<script>
    const practiceQuestion = JSON.parse('{{ question.practice_question | replace("'", '"') | safe }}')

    const hintIcon = document.getElementById("hintIcon");
    if (hintIcon) {
        hintIcon.addEventListener("click", function() {
            var hintModal = new bootstrap.Modal(document.getElementById("hintModal"));
            hintModal.show();
        });
    }
</script>
<script src="/quiz/practice_question_scripts.js"></script>
<script src="/quiz/drop_node.js"></script>