{% extends "base.html" %}
{% block title_tag %}
    <title data-i18n="navTesting">Тестирование по компьютерным сетям</title>
{% endblock %}
{% block description %}<meta name="description" content="Сетевой тренажер для обучения компьютерным сетям" data-i18n-attr="content:workspaceDocDescription">{% endblock %}

{% block content %}

    <section class="container py-5 my-lg-5">
        <div class="row" style="align-content: center; justify-content: space-between">
            <div class="col-auto">
                <h1 class="me-3" data-i18n="quizTitle">Тестирование по компьютерным сетям</h1>
            </div>
        </div>

        <!-- Item -->
        {% for quiz in quizzes %}
            <article class="card border-0 shadow-sm overflow-hidden mb-4">
                <div class="row g-0" style="align-items: baseline">
                    <div class="col-sm-8">
                        <div class="card-body" style="margin-left: 20px;">
                            <h4 class="h4" style="margin-top: 20px;margin-bottom: 4px">
                                <a href="{{ url_for('get_sections_by_test_endpoint', test_id=quiz.test_id) }}">{{ quiz.test_name }}</a>
                            </h4>
                            {% if quiz.description %}
                                <p style="margin-bottom: 4px">{{ quiz.description }}</p>
                            {% else %}
                                <p style="margin-bottom: 20px;"></p>
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="card-body">
                            <p id="{{ quiz.test_id }}"
                               style="text-align: right; margin-right: 40px; margin-top: 20px;"></p>
                        </div>
                    </div>
                </div>
            </article>

            <script>
                (function() {
                    function localizeQuizItem() {
                        const translations = window.translations[currentLanguage] || {};
                        const sectionTitles = [
                            translations.sectionsCount_one || 'раздел',
                            translations.sectionsCount_few || 'раздела',
                            translations.sectionsCount_many || 'разделов'
                        ];

                        function morph(n, titles) {
                            return titles[(n % 10 === 1 && n % 100 !== 11) ? 0 : (n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20)) ? 1 : 2];
                        }

                        const sectionCount = parseInt('{{ quiz.section_count }}');
                        const element = document.getElementById('{{quiz.test_id}}');
                        if (element) {
                            element.innerHTML = sectionCount + ' ' + morph(sectionCount, sectionTitles);
                        }
                    }

                    if (window.translations && window.currentLanguage) {
                        localizeQuizItem();
                    }

                    document.addEventListener('languageChanged', localizeQuizItem);
                })();
            </script>
        {% endfor %}

    </section>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof window.originalApplyTranslations === 'undefined') {
                window.originalApplyTranslations = window.applyTranslations;
                
                window.applyTranslations = function(lang) {
                    window.originalApplyTranslations(lang);
                    const event = new Event('languageChanged');
                    document.dispatchEvent(event);
                };
            }
        });
    </script>
{% endblock %}